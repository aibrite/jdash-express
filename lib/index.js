"use strict";var moment=require("moment"),JDashApi=function(){function t(t){this.options=t,this.provider=t.provider}return t.prototype.handleError=function(t){},t.prototype.deleteDashletRoute=function(t,e,r){var i=t.params.id;this.options.principal(t);this.provider.deleteDashlet(i).then(function(){return e.sendStatus(200)}).catch(function(t){return r(t)})},t.prototype.saveDashletRoute=function(t,e,r){this.options.principal(t);var i=t.params.id,o=t.body;this.provider.updateDashlet(i,o).then(function(t){return e.sendStatus(200)}).catch(function(t){return r(t)})},t.prototype.createDashletRoute=function(t,e,r){var i=t.body,o=(this.options.principal(t),{title:i.title,configuration:i.configuration,description:i.description,createdAt:moment().utc().toDate(),dashboardId:i.dashboardId,moduleId:i.moduleId});this.provider.createDashlet(o).then(function(t){return e.send(t)}).catch(function(t){return r(t)})},t.prototype.saveDashboardRoute=function(t,e,r){var i,o=this,a=this.options.principal(t),s=t.params.id,n=t.body;return n&&n.layout&&n.layout.dashlets&&(i=this.provider.getDashboard(a.appid,s).then(function(t){var e=t.dashlets.map(function(t){return t.id}),r=Object.keys(n.layout.dashlets),i=e.filter(function(t){return-1===r.indexOf(t)});return o.provider.deleteDashlet(i)})),i?i.then(function(){o.provider.updateDashboard(a.appid,s,n).then(function(t){return e.sendStatus(200)}).catch(function(t){return r(t)})}):this.provider.updateDashboard(a.appid,s,n).then(function(t){return e.sendStatus(200)}).catch(function(t){return r(t)})},t.prototype.getMyDashboardRoute=function(t,e,r){var i=this.options.principal(t);this.provider.searchDashboards({appid:i.appid,user:i.user}).then(function(t){return e.send(t)})},t.prototype.deleteDashboardRoute=function(t,e,r){var i=t.params.id,o=this.options.principal(t);this.provider.deleteDashboard(o.appid,i).then(function(){return e.sendStatus(200)}).catch(function(t){return r(t)})},t.prototype.searchDashboardsRoute=function(t,e,r){var i=this.options.principal(t),o=t.body.search,a=t.body.query;this.provider.searchDashboards({appid:i.appid,shareWith:o.shareWith,user:o.user},a).then(function(t){return e.send(t)})},t.prototype.createDashboardRoute=function(t,e,r){var i=this.options.principal(t),o=t.body,a={title:o.title,appid:i.appid,config:o.config,createdAt:moment().utc().toDate(),description:o.description,layout:o.layout,shareWith:o.shareWith,user:i.user,id:null};this.provider.createDashboard(a).then(function(t){return e.send(t)}).catch(function(t){return r(t)})},t.prototype.getDashboardRoute=function(t,e,r){var i=t.params.id,o=this.options.principal(t);this.provider.getDashboard(o.appid,i).then(function(t){return e.send(t)}).catch(function(t){return r(t)})},t.prototype.use=function(t){return t.get("/dashboard/my",this.getMyDashboardRoute.bind(this)),t.get("/dashboard/:id",this.getDashboardRoute.bind(this)),t.post("/dashboard/create",this.createDashboardRoute.bind(this)),t.post("/dashboard/search",this.searchDashboardsRoute.bind(this)),t.post("/dashboard/delete/:id",this.deleteDashboardRoute.bind(this)),t.post("/dashboard/save/:id",this.saveDashboardRoute.bind(this)),t.post("/dashlet/create",this.createDashletRoute.bind(this)),t.post("/dashlet/delete/:id",this.deleteDashletRoute.bind(this)),t.post("/dashlet/save/:id",this.saveDashletRoute.bind(this)),this},t}();exports.JDashApi=JDashApi,Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(t){return new JDashApi(t)};